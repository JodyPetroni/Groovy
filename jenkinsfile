node {
    stage('SCM') {
        echo 'GETTING CODE FROM SORUCE CONTROL....'
        git branch:'${branch}', url: 'https://github.com/JodyPetroni/Groovy.git'
    }
    stage('Build') {
        echo 'Building....'
        sh '/usr/bin/dotnet --version'
        sh '/usr/bin/dotnet build src/console.csproj'
    }
    stage('Terraform Init'){
        steps {
                ansiColor('xterm') {
                withCredentials([azureServicePrincipal(
                credentialsId: 'b4d31966-2e73-4296-a625-30f361c0090b',
                subscriptionIdVariable: 'ARM_SUBSCRIPTION_ID',
                clientIdVariable: 'ARM_CLIENT_ID',
                clientSecretVariable: 'ARM_CLIENT_SECRET',
                tenantIdVariable: 'ARM_TENANT_ID'
            ), string(credentialsId: 'access_key', variable: 'ARM_ACCESS_KEY')]) {

                    sh """

                    echo "Initialising Terraform"
                    terraform init -backend-config="access_key=$ARM_ACCESS_KEY"
                    """
                       }
                }
         }
    }
    stage('Test') {
        echo 'Testing....'
        
        shared()
    }
    stage('Deploy') {
        echo 'Deploying....'
    }
}
